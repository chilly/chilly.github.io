<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.ico">
  <link rel="mask-icon" href="/icon.svg" color="#222">
  <meta name="google-site-verification" content="hcdiytqUGPoTW0eAaN6TWAmRfiv7IWFIIc9DKNr7Eno">
  <meta name="yandex-verification" content="eb8f01295fdccb3d">
  <meta name="baidu-site-verification" content="QoJxa8tZnO">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Times+New+Roman:300,300italic,400,400italic,700,700italic%7CRaleway:300,300italic,400,400italic,700,700italic%7COswald:300,300italic,400,400italic,700,700italic%7CWork+Sans:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"chillyc.info","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":20,"unescape":false,"preload":false}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/config.min.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="帐前卒专栏">
<meta property="og:url" content="http://chillyc.info/page/23/">
<meta property="og:site_name" content="帐前卒专栏">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="帐前卒">
<meta property="article:tag" content="有意思的代码，有意思的架构, 有趣的小说, 好看的故事, code, software, articles, novel, architect">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://chillyc.info/page/23/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/23/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>帐前卒专栏 - code, software architect, articles and novels.<br/>代码，软件架构，博客和小说</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/rss2.xml" title="帐前卒专栏" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <!-- Global site tag (gtag.js) - Google Analytics start -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-11621532-3"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6565392687771630"
     crossorigin="anonymous"></script>
<script>
  window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-11621532-3');
</script>
 <!-- Global site tag (gtag.js) - Google Analytics end -->
  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">帐前卒专栏</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">code, software architect, articles and novels.<br/>代码，软件架构，博客和小说</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-feeds"><a href="/rss2.xml" rel="section"><i class="fa fa-feed fa-fw"></i>feeds</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="帐前卒"
      src="/icon.svg">
  <p class="site-author-name" itemprop="name">帐前卒</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">798</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">756</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NoaWxseQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chilly"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9jY3R0XzE=" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;cctt_1"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLW5kLzQuMC8="><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/big/by_nc_nd.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/10/11/2010-10-11-create-class-size-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/10/11/2010-10-11-create-class-size-0/" class="post-title-link" itemprop="url">How to Create a Class , Which Size Is 0?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2010-10-11T00:00:00+08:00">2010-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 23:07:50" itemprop="dateModified" datetime="2023-10-05T23:07:50+08:00">2023-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>271</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <meta name="_edit_last" content="1" />
<meta name="_su_rich_snippet_type" content="none" />
<meta name="views" content="611" />
<meta name="_wp_old_slug" content="apply-class-size-0" />
how to create a class , which size is 0?
<p>If you create a class with array [0], you have done it.😄</p>
<p>Only in gcc compiler…in visual c++6.0, it is still 1.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include&amp;lt;iostream&amp;gt;</span><br><span class="line">using namespace std;</span><br><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">	char a[0];</span><br><span class="line">&#125;;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	cout &amp;lt;&amp;lt; sizeof(A);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/10/09/5929554/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/10/09/5929554/" class="post-title-link" itemprop="url">Linux Crontab and at 命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-10-09 14:32:00" itemprop="dateCreated datePublished" datetime="2010-10-09T14:32:00+08:00">2010-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>5.6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>5 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="引用地址-httpfreeyes81netyes81view-1179html"><a class="markdownIt-Anchor" href="#引用地址-httpfreeyes81netyes81view-1179html"></a> 引用地址： [ <span class="exturl" data-url="aHR0cDovL2ZyZWUueWVzODEubmV0L3llczgxL3ZpZXctMTE3OS5odG1s">http://free.yes81.net/yes81/view-1179.html<i class="fa fa-external-link-alt"></i></span></h3>
<p>](<span class="exturl" data-url="aHR0cDovL2ZyZWUueWVzODEubmV0L3llczgxL3ZpZXctMTE3OS5odG1s">http://free.yes81.net/yes81/view-1179.html<i class="fa fa-external-link-alt"></i></span>)</p>
<h3 id="crontab-命令"><a class="markdownIt-Anchor" href="#crontab-命令"></a> crontab  命令</h3>
<p>功能是在一定的时间间隔调度一些命令的执行。在  /etc  目录下有一个  crontab<br />
文件，这里存放有系统运行的一些调度程序。每个用户可以建立自己的调度  crontab  。<br />
crontab  命令有三种形式的命令行结构：<br />
crontab [-u user] [file]<br />
crontab [-u user] [-e|-l|-r]<br />
crontab -l -u [-e|-l|-r]<br />
第一个命令行中，  file  是命令文件的名字。如果在命令行中指定了这个文件，那么执行  crontab  命令，则将这个文件拷贝到  crontabs<br />
目录下；如果在命令行中没有制定这个文件，  crontab  命令将接受标准输入（键盘）上键入的命令，并将他们也存放在  crontab  目录下。<br />
命令行中  -r  选项的作用是从  /usr/spool/cron/crontabs  目录下删除用户定义的文件  crontab  ；<br />
命令行中  -l  选项的作用是显示用户  crontab  文件的内容。<br />
使用命令  crontab -u user -e  命令编辑用户  user  的  cron©  作业。用户通过编辑文件来增加或修改任何作业请求。<br />
执行命令  crontab -u user -r  即可删除当前用户的所有的  cron  作业。<br />
作业与它们预定的时间储存在文件  /usr/spool/cron/crontabs/username  里。  username<br />
使用户名，在相应的文件中存放着该用户所要运行的命令。命令执行的结果，无论是标准输出还是错误输出，都将以邮件形式发给用户。文件里的每一个请求必须包含以<br />
spaces  和  tabs  分割的六个域。前五个字段可以取整数值，指定何时开始工作，第六个域是字符串，称为命令字段，其中包括了  crontab<br />
调度执行的命令。<br />
第一道第五个字段的整数取值范围及意义是：<br />
0  ～  59  表示分<br />
1  ～  23  表示小时<br />
1  ～  31  表示日<br />
1  ～  12  表示月份<br />
0  ～  6  表示星期（其中  0  表示星期日）<br />
/usr/lib/cron/cron.allow  表示谁能使用  crontab<br />
命令。如果它是一个空文件表明没有一个用户能安排作业。如果这个文件不存在，而有另外一个文件  /usr/lib/cron/cron.deny,<br />
则只有不包括在这个文件中的用户才可以使用  crontab  命令。如果它是一个空文件表明任何用户都可安排作业。两个文件同时存在时  cron.allow<br />
优先，如果都不存在，只有超级用户可以安排作业。<br />
任务调度的  crond  常驻命令<br />
crond  是  linux  用来定期执行程序的命令。当安装完成操作系统之后，默认便会启动此任务调度命令。  crond<br />
命令每分锺会定期检查是否有要执行的工作，如果有要执行的工作便会自动执行该工作。而  linux  任务调度的工作主要分为以下两类：<br />
1  、系统执行的工作：系统周期性所要执行的工作，如备份系统数据、清理缓存<br />
2  、个人执行的工作：某个用户定期要做的工作，例如每隔  10  分钟检查邮件服务器是否有新信，这些工作可由每个用户自行设置。<br />
一、任务调度设置文件的写法<br />
其格式如下：<br />
Minute Hour Day Month Dayofweek command<br />
分钟  小时  天  月  天每星期  命令<br />
每个字段代表的含义如下：<br />
Minute  每个小时的第几分钟执行该任务<br />
Hour  每天的第几个小时执行该任务<br />
Day  每月的第几天执行该任务<br />
Month  每年的第几个月执行该任务<br />
DayOfWeek  每周的第几天执行该任务<br />
Command  指定要执行的程序<br />
在这些字段里，除了“  Command  ”是每次都必须指定的字段以外，其它字段皆为可选字段，可视需要决定。对于不指定的字段，要用“  *<br />
”来填补其位置。<br />
举例如下：<br />
1  、指定每小时的第  5  分钟执行一次  ls  命令<br />
5 * * * * ls<br />
2  、指定每天的  5:30  执行  ls  命令<br />
30 5 * * * ls<br />
3  、指定每月  8  号的  7  ：  30  分执行  ls  命令<br />
30 7 8 * * ls<br />
4  、指定每年的  6  月  8  日  5  ：  30  执行  ls  命令<br />
30 5 8 6 * ls<br />
5  、指定每星期日的  6:30  执行  ls  命令<br />
30 6 * * 0 ls<br />
注：  0  表示星期天，  1  表示星期  1  ，以此类推，也可以用英文来表示，  sun  表示星期天，  mon  表示星期一等。<br />
6  、每月  10  号及  20  号的  3  ：  30  执行  ls  命令<br />
30 3 10,20 * * ls<br />
注：“，”用来连接多个不连续的时段<br />
7  、每天  8-11  点的第  25  分钟执行  ls  命令<br />
25 8-11 * * * ls<br />
注：“  -  ”用来连接连续的时段<br />
8  、每  15  分钟执行一次  ls  命令<br />
*/15 * * * * ls<br />
即每个小时的第  0 15 30 45 60  分钟执行  ls  命令<br />
9  、每个月中，每隔  10  天  6:30  执行一次  ls  命令<br />
30 6 */10 * * ls<br />
即每月的  1  、  11  、  21  、  31  日是的  6  ：  30  执行一次  ls  命令。<br />
10  、每天  7  ：  50  以  root  身份执行  /etc/cron.daily  目录中的所有可执行文件<br />
50 7 * * * root run-parts /etc/cron.daily<br />
注：  run-parts  参数表示，执行后面目录中的所有可执行文件。<br />
二、新增调度任务<br />
新增调度任务可用两种方法：<br />
1  、在命令行输入  : crontab -e  然后添加相应的任务，  wq  存盘退出。<br />
2  、直接编辑  /etc/crontab  文件，即  vi /etc/crontab  ，添加相应的任务。<br />
三、查看调度任务<br />
crontab -l //  列出当前的所有调度任务<br />
crontab -l -u jp    //  列出用户  jp  的所有调度任务<br />
四、删除任务调度工作<br />
crontab -r //  删除所有任务调度工作<br />
五、任务调度执行结果的转向<br />
例  1  ：每天  5  ：  30  执行  ls  命令，并把结果输出到  /jp/test  文件中<br />
30 5 * * * ls &gt;/jp/test 2&gt;&amp;1<br />
注：  2&gt;&amp;1  表示执行结果及错误信息。<br />
编辑  /etc/crontab  文件配置  cron<br />
cron  服务每分钟不仅要读一次  /var/spool/cron  内的所有文件，还需要读一次  /etc/crontab,<br />
因此我们配置这个文件也能运用  cron  服务做一些事情。用  crontab  配置是针对某个用户的，而编辑  /etc/crontab<br />
是针对系统的任务。此文件的文件格式是  :<br />
SHELL=/bin/bash<br />
PATH=/sbin:/bin:/usr/sbin:/usr/bin<br />
MAILTO=root //  如果出现错误，或者有数据输出，数据作为邮件发给这个帐号<br />
HOME=/ //  使用者运行的路径  ,  这里是根目录</p>
<h1 id="run-parts"><a class="markdownIt-Anchor" href="#run-parts"></a> run-parts</h1>
<p>01 * * * * root run-parts /etc/cron.hourly //  每小时执行  /etc/cron.hourly  内的脚本<br />
02 4 * * * root run-parts /etc/cron.daily //  每天执行  /etc/cron.daily  内的脚本<br />
22 4 * * 0 root run-parts /etc/cron.weekly //  每星期执行  /etc/cron.weekly  内的脚本<br />
42 4 1 * * root run-parts /etc/cron.monthly //  每月去执行  /etc/cron.monthly  内的脚本<br />
大家注意  “run-parts”  这个参数了，如果去掉这个参数的话，后面就可以写要运行的某个脚本名，而不是文件夹名了</p>
<p>以下转自鸟哥私房菜</p>
<p><span class="exturl" data-url="aHR0cDovL2xpbnV4LnZiaXJkLm9yZy9saW51eF9iYXNpYy8wNDMwY3Jvbi5waHAjYXQ=">http://linux.vbird.org/linux_basic/0430cron.php#at<i class="fa fa-external-link-alt"></i></span><br />
單一工作排程的進行就使用 at 這個指令囉！這個指令的運作非常簡單！將 at 加上一個時間即可！基本的語法如下：</p>
<pre><code>[root@www ~]# at [-mldv] TIME

[root@www ~]# at -c 工作號碼

選項與參數：
-m  ：當 at 的工作完成後，即使沒有輸出訊息，亦以 email 通知使用者該工作已完成。
-l  ：at -l 相當於 atq，列出目前系統上面的所有該使用者的 at 排程；
-d  ：at -d 相當於 atrm ，可以取消一個在 at 排程中的工作；
-v  ：可以使用較明顯的時間格式列出 at 排程中的工作列表；
-c  ：可以列出後面接的該項工作的實際指令內容。

TIME：時間格式，這裡可以定義出『什麼時候要進行 at 這項工作』的時間，格式有：
  HH:MM				ex&gt; 04:00
	在今日的 HH:MM 時刻進行，若該時刻已超過，則明天的 HH:MM 進行此工作。
  HH:MM YYYY-MM-DD		ex&gt; 04:00 2009-03-17
	強制規定在某年某月的某一天的特殊時刻進行該工作！
  HH:MM[am|pm] [Month] [Date]	ex&gt; 04pm March 17
	也是一樣，強制在某年某月某日的某時刻進行！
  HH:MM[am|pm] + number [minutes|hours|days|weeks]
	ex&gt; now + 5 minutes	ex&gt; 04pm + 3 days
	就是說，在某個時間點『再加幾個時間後』才進行。
</code></pre>
<p>老實說，這個 at 指令的下達最重要的地方在於『時間』的指定了！鳥哥喜歡使用『 now + … 』<br />
的方式來定義現在過多少時間再進行工作，但有時也需要定義特定的時間點來進行！底下的範例先看看囉！</p>
<pre><code>範例一：再過五分鐘後，將 /root/.bashrc 寄給 root 自己

[root@www ~]# at now + 5 minutes
  &lt;==記得單位要加 s 喔！

at&gt; /bin/mail root -s &quot;testing at job&quot; &lt; /root/.bashrc

at&gt; &lt;EOT&gt;   &lt;==這裡輸入 [ctrl] + d 就會出現 &lt;EOF&gt; 的字樣！代表結束！

job 4 at 2009-03-14 15:38
# 上面這行資訊在說明，第 4 個 at 工作將在 2009/03/14 的 15:38 進行！
# 而執行 at 會進入所謂的 at shell 環境，讓你下達多重指令等待運作！
範例二：將上述的第 4 項工作內容列出來查閱

[root@www ~]# at -c 4

#!/bin/sh               &lt;==就是透過 bash shell 的啦！

# atrun uid=0 gid=0
# mail     root 0
umask 22
....(中間省略許多的環境變數項目)....

cd /root || &#123;           &lt;==可以看出，會到下達 at 時的工作目錄去執行指令

         echo 'Execution directory inaccessible' &gt;&amp;2
         exit 1
&#125;

/bin/mail root -s &quot;testing at job&quot; &lt; /root/.bashrc
# 你可以看到指令執行的目錄 (/root)，還有多個環境變數與實際的指令內容啦！
範例三：由於機房預計於 2009/03/18 停電，我想要在 2009/03/17 23:00 關機？

[root@www ~]# at 23:00 2009-03-17

at&gt; /bin/sync

at&gt; /bin/sync

at&gt; /sbin/shutdown -h now

at&gt; &lt;EOT&gt;
job 5 at 2009-03-17 23:00
# 您瞧瞧！ at 還可以在一個工作內輸入多個指令呢！不錯吧！
</code></pre>
<p>事實上，當我們使用 at 時會進入一個 at shell 的環境來讓使用者下達工作指令，此時，  建議你最好使用絕對路徑來下達你的指令，比較不會有問題喔<br />
！由於指令的下達與 PATH 變數有關， 同時與當時的工作目錄也有關連 (如果有牽涉到檔案的話)，因此使用絕對路徑來下達指令，會是比較一勞永逸的方法。<br />
為什麼呢？舉例來說，你在 /tmp 下達『 at now 』然後輸入『 mail root -s “test” &lt; .bashrc 』， 問一下，那個<br />
.bashrc 的檔案會是在哪裡？答案是『 /tmp/.bashrc 』！因為  at 在運作時，會跑到當時下達 at 指令的那個工作目錄  的緣故啊！</p>
<p>有些朋友會希望『我要在某某時刻，在我的終端機顯示出 Hello 的字樣』，然後就在 at 裡面下達這樣的資訊『 echo “Hello”<br />
』。等到時間到了，卻發現沒有任何訊息在螢幕上顯示，這是啥原因啊？  這是因為 at 的執行與終端機環境無關，而所有 standard<br />
output/standard error output 都會傳送到執行者的 mailbox 去  啦！所以在終端機當然看不到任何資訊。那怎辦？沒關係，<br />
可以透過終端機的裝置來處理！假如你在 tty1 登入，則可以使用『 echo “Hello” &gt; /dev/tty1 』來取代。</p>
<p>** Tips: **<br />
要注意的是，如果在 at shell 內的指令並沒有任何的訊息輸出，那麼 at 預設不會發 email 給執行者的。 如果你想要讓 at 無論如何都發一封<br />
email 告知你是否執行了指令，那麼可以使用『 at -m 時間格式 』來下達指令喔！ at 就會傳送一個訊息給執行者，而不論該指令執行有無訊息輸出了！</p>
<p>at 有另外一個很棒的優點，那就是『背景執行』的功能了！什麼是背景執行啊？很難瞭解嗎？其實與 bash 的 nohup ( <a target="_blank" rel="noopener" href="http://linux.vbird.org/linux_basic/0440processcontrol.php#nohup"> 第十七章<br />
</a> ) 類似啦！<br />
鳥哥提我自己的幾個例子來給您聽聽，您就瞭了！</p>
<ul>
<li>
<p>離線繼續工作的任務  ：鳥哥初次接觸 Unix 為的是要跑空氣品質模式， 那是一種大型的程式，這個程式在當時的硬體底下跑，一個案例要跑 3 天！由於鳥哥也要進行其他研究工作，因此常常使用 Windows 98 來連線到 Unix 工作站跑那個 3 天的案例！結果你也該知道， Windows 98 連開三天而不當機的機率是很低的～@_@～ 而當機時，所有在 Windows 上的連線都會中斷！包括鳥哥在跑的那個程式也中斷了～嗚嗚～明明再三個鐘頭就跑完的程式， 由於當機害我又得跑 3 天！</p>
</li>
<li>
<p>另一個常用的時刻則是例如上面的範例三，由於某個突發狀況導致你必須要進行某項工作時，這個 at 就很好用啦！</p>
</li>
</ul>
<p>由於 at 工作排程的使用上，系統會將該項 at 工作獨立出你的 bash 環境中， 直接交給系統的 atd 程式來接管，因此，當你下達了 at<br />
的工作之後就可以立刻離線了， 剩下的工作就完全交給 Linux 管理即可  ！所以囉，如果有長時間的網路工作時，嘿嘿！ 使用 at<br />
可以讓你免除網路斷線後的困擾喔！ <sup>_</sup></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/09/20/5897786/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/09/20/5897786/" class="post-title-link" itemprop="url">老姐婚礼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-09-20 18:57:00" itemprop="dateCreated datePublished" datetime="2010-09-20T18:57:00+08:00">2010-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>263</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>老姐在东北完成婚礼…然后准备在家乡摆个婚宴。</p>
<p>因为老姐的缘故，有幸逛了下喀左。北方的小镇，风还是蛮舒服的。因为工业不发达，所以很适合人类居住。小镇很好，大概走路也就是30分钟就可以贯穿整个小镇。这个时间<br />
只够我从软件所走到计算所。</p>
<p>婚礼蛮成功的，特别是老姐和姐夫自己做的flash，效果很不错。当然婚礼中还有几处细节不尽人意。1，烟花不那么容易点着。2，荧光水没有将心形容器灌满。彩排了多<br />
次，紧张还是在所难免。不过氛围很好，很煽情:)值得一提的是，老姐那天灰常漂亮~</p>
<p>整个旅程唯一不足的是，叔每次都喝多，而且还打呼噜…我实在难以入睡。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/09/07/5868606/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/09/07/5868606/" class="post-title-link" itemprop="url">MFC CString Wstring Char Wchar _T 关系及转换</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-09-07 15:07:00" itemprop="dateCreated datePublished" datetime="2010-09-07T15:07:00+08:00">2010-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>2 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近做了下宽字符，窄字符的实验。发现了一系列的有趣东东。我发现我过去一直使用Ascii编码。现在发现unicode还是灰常有用的。</p>
<p>首先std::string std::wstring 和CString 这几个东东最好不要用于DLL的接口之中，不管是返回值还是传入的参数。当然编译时是不会<br />
出错的，但是链接可能会有各种奇异的问题，比如不能识别CString等等。所以建议DLL接口还是使用LPCTSTR LPCSTR<br />
LPCWSTR以及我们经常使用的char*. 反正是DLL接口中的类型越基础也好。当然你可以尝试使用复合类型。</p>
<p>这里的的LPCTSTR 就是const TCHAR <em>, LPCSTR 就是const char</em> , LPCWSTR就是 const<br />
wchar_t*。LP就是指针的意思，C就是const,T就是TCHAR, W就是wchar_t, 然后大家都有STR的后缀。关于TCHAR,char,<br />
以及wchar_t之间的关系，其实看你是否定义了_UNICODE宏，想要定义的话需要在编译的时候添加编译参数-<br />
D_UNICODE即可。如果定义了这个宏，那么wchar_t就是TCHAR, 否则 TCHAR就是<br />
char,其实这里就是为了灵活性。对于vs系列，想要识别unicode编码，需要在字符或者字符串前添加L,例如：</p>
<p>wchar_t a = L’a’; wchar_t *b = L&quot;abc&quot;;</p>
<p>关于_T()的使用，或许就明了了，_T(“ab”) 就是L&quot;ab&quot; , _T(‘c’) 就是 L’c’, _T(x)的宏定义就是 L ## x，其意思就是将<br />
L和x像字符串一样连接在一起。关于宏定义的各种用法，感兴趣的可以search.当然为了灵活性，这里也是使用了_T也有两个定义这个也与是否定义了_UNICOD<br />
E宏有关系。</p>
<p>所谓窄字符其实就是ascii字符，这个东东只有1个字节。而宽字符有2个字节。这就是宽字和窄字的不同了。当然这里还有WORD和DWORD,这里的WORD其实就<br />
是unsigned short,就是2个字节和wchar_t一样。而DWORD就是unsigned<br />
long也就是4字节。根据特殊的应用，有不同的效果。不过说到底还是各种基础类型转来转去的。</p>
<p>关于各种类型的互相转换其实不是很简单，不过大都可以通过CString来转换。各种窄字符可以直接放入到CString构造函数中，它将自动的为所有的字符添加L.<br />
让其成为unicode. 例如</p>
<p>const char * a = “abc”; CString s(a);</p>
<p>其实CString可以强制转换为LPCTSTR,如果想强制转换为其他的类型，最好考虑下是否有后遗症。但是强转为LPCTSTR是没有问题的。另外std::ws<br />
tring本身是有wchar_t的数组构成的。而std::string本身是有char数组构成的。对于这些类型只需要调用<br />
c_str()就可以转变为const wchar_t* 或者 const char*.另外因为string,wstring, CString这几个东东都有引<br />
用计数的机制，所以在多线程编程中，尽量不要使用。另外对于CString而言，这个东西可以强制不使用引用计数机制，只需要调用lockBuffer即可。另外CS<br />
tring转char* 如果是在Atl编程的情况下可以使用T2A（）这个函数，对于其他可以调用WideCharToMultiByte（）这个函数：</p>
<p>WideCharToMultiByte( __in UINT CodePage, __in DWORD dwFlags, __in_opt LPCWSTR<br />
lpWideCharStr, __in int cchWideChar, __out_bcount_opt(cbMultiByte) LPSTR<br />
lpMultiByteStr, __in int cbMultiByte, __in_opt LPCSTR lpDefaultChar, __out_opt<br />
LPBOOL lpUsedDefaultChar);</p>
<p>这个东东有8个参数，不过一般你如果使用TCHAR* 转 char* 只需要使用其中的若干个。一般使用：WideCharToMultiByte(CP_ACP,<br />
0, lpw, -1, lpa, nChars, NULL, NULL); lpw是你传入的TCHAR* or wchar_t, lpa是你最终的转换数组，<br />
当然这个东东开始的内容需要自己分配，当然如果nChars这个是0的话，其实这个函数只是数了下宽字符的个数，然后将这个个数当做返回值返回，如果nChars这个<br />
不为零，那么就是要填充的大小了，并且这个函数真正做了将宽字符转换成bytes的工作。CP_ACP这个是ascii页表。后两个产生对于未知的编码很有用，最后一<br />
个你可以传入一个bool型的指针，如果所有的宽字符没有对应的多个窄字符,那么就会被倒数第二个参数替代，如果第二参数是NULL,那么就会使用?替代。当然此时这<br />
个bool型指针的值就会变为true.</p>
<p>这样就可以各种类型的转换了。首先所有的类型转换为CString, 然后再用CString转为各种类型。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/09/03/database/2010-09-03-postgresql-function-define/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/09/03/database/2010-09-03-postgresql-function-define/" class="post-title-link" itemprop="url">Postgresql Function Define</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2010-09-03T00:00:00+08:00">2010-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-06 22:54:06" itemprop="dateModified" datetime="2023-10-06T22:54:06+08:00">2023-10-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>3 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <meta name="_edit_last" content="1" />
<meta name="_su_rich_snippet_type" content="none" />
<meta name="views" content="1573" />
In Postgresql, If you want to do something like "select Hello(a) from A;". You should define your own function Hello().
<p>First, go to postgresql root directory and go into contrib file folder. Create your own directory, and add hello.h , hello.c, Makefile, <span class="exturl" data-url="aHR0cDovL2hlbGxvLnNxbC5pbg==">hello.sql.in<i class="fa fa-external-link-alt"></i></span> and uninstall_Hello.sql.in</p>
<p>Makefile is like the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MODULE_big  = Hello // this is module name</span><br><span class="line">OBJS = Hello.o // those will be create by execute &quot;make&quot;</span><br><span class="line"></span><br><span class="line">DATA_built = hello.sql // install your function using this sql file</span><br><span class="line">DATA = uninstall_Hello.sql</span><br><span class="line">SHLIB_LINK = $(BE_DLLLIBS)</span><br><span class="line"></span><br><span class="line">ifdef USE_PGXS // this is a build infrastructure of extentions in postgreSQL</span><br><span class="line">PGXS = $(shell pg_config --pgxs)</span><br><span class="line">include $(PGXS)</span><br><span class="line">else</span><br><span class="line">subdir = contrib/Hello // here is your code files</span><br><span class="line">top_builddir = ../..</span><br><span class="line">include $(top_builddir)/src/Makefile.global</span><br><span class="line">include $(top_srcdir)/contrib/contrib-global.mk</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">// the following code fragment is copying content of *.sql.in into *.sql</span><br><span class="line">%.sql: %.source</span><br><span class="line">	rm -f $@; \</span><br><span class="line">	C=`pwd`; \</span><br><span class="line">	sed -e &quot;s:_OBJWD_:$$C:g&quot; &amp;lt; $&amp;lt; &amp;gt; $@</span><br></pre></td></tr></table></figure>
<p>Attention!!! In Makefile those command should be with no blank at end.<br />
Here we can write <span class="exturl" data-url="aHR0cDovL2hlbGxvLnNxbC5pbg==">hello.sql.in<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">SET search_path = public; --you should add this code first.</span><br><span class="line">--functions</span><br><span class="line">--take care of those functions, if those functions are used for data input and out, their args or return type must be cstring or varchar</span><br><span class="line"></span><br><span class="line">-- arg type is cstring</span><br><span class="line">CREATE OR REPLACE FUNCTION hello_in(cstring)</span><br><span class="line">   RETURNS HelloS</span><br><span class="line">   AS &#x27;MODULE_PATHNAME&#x27;</span><br><span class="line">   LANGUAGE C IMMUTABLE STRICT;</span><br><span class="line">-- return type is cstring</span><br><span class="line">CREATE OR REPLACE FUNCTION hello_out(HelloS)</span><br><span class="line">   RETURNS cstring</span><br><span class="line">   AS &#x27;MODULE_PATHNAME&#x27;</span><br><span class="line">   LANGUAGE C IMMUTABLE STRICT;</span><br><span class="line"></span><br><span class="line">--data type</span><br><span class="line">CREATE TYPE HelloS (</span><br><span class="line">   internallength = 52,</span><br><span class="line">   input = hello_in,</span><br><span class="line">   output = hello_out,</span><br><span class="line">   alignment = double</span><br><span class="line">);</span><br><span class="line">--size is 52 bytes and alignment is 8 bytes.</span><br><span class="line">--if you don&#x27;t know its real size, use internallength = VARIABLE</span><br><span class="line">--if you want use binary array as its input and out, you should use receive=XXX_function, and send = XXX_function</span><br><span class="line"></span><br><span class="line">--outer function</span><br><span class="line">--this function can use kinds of types</span><br><span class="line">CREATE OR REPLACE FUNCTION Hello(HelloS)</span><br><span class="line">   RETURNS cstring</span><br><span class="line">   AS &#x27;MODULE_PATHNAME&#x27;</span><br><span class="line">   LANGUAGE C IMMUTABLE STRICT;</span><br></pre></td></tr></table></figure>
<p>Here is the uninstall_Hello.sql.in:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET search_path = public;</span><br><span class="line"></span><br><span class="line">DROP FUNCTION hello_in(cstring);</span><br><span class="line">DROP FUNCTION hello_out(HelloS);</span><br><span class="line">DROP TYPE HelloS;</span><br><span class="line">DROP FUNCTION Hello(HelloS);</span><br></pre></td></tr></table></figure>
<p>In hello.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#ifndef HELLO_H</span><br><span class="line">#define HELLO_H</span><br><span class="line">#include&amp;lt;stdio.h&amp;gt;</span><br><span class="line">#include&amp;lt;stdlib.h&amp;gt;</span><br><span class="line"></span><br><span class="line">#include &quot;postgres.h&quot;</span><br><span class="line">#include &quot;fmgr.h&quot;</span><br><span class="line">#include &quot;funcapi.h&quot;</span><br><span class="line">// you should take care of the order of those head files!!!</span><br><span class="line"></span><br><span class="line">typedef struct&#123;</span><br><span class="line">	char content[52];</span><br><span class="line">&#125;HelloS;</span><br><span class="line"></span><br><span class="line">Datum		hello_in(PG_FUNCTION_ARGS);</span><br><span class="line">Datum		hello_out(PG_FUNCTION_ARGS);</span><br><span class="line">Datum               Hello(PG_FUNCTION_ARGS);</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>hello.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include “hello.h”</span><br><span class="line"></span><br><span class="line">#ifndef MOD_FOR_PG</span><br><span class="line">PG_MODULE_MAGIC;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">PG_FUNCTION_INFO_V1(hello_in);</span><br><span class="line">Datum</span><br><span class="line">hello_in(PG_FUNCTION_ARGS)</span><br><span class="line">&#123;</span><br><span class="line">	// get args[0]</span><br><span class="line">	char * str = PG_GETARG_CSTRING(0);</span><br><span class="line">    HelloS * hs = palloc(sizeof(HelloS));</span><br><span class="line">    if(NULL != str)&#123;</span><br><span class="line">        strcpy(hs-&amp;gt;content,str);</span><br><span class="line">        PG_RETURN_POINTER(hs)</span><br><span class="line">    &#125;</span><br><span class="line">    PG_RETURN_NULL();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PG_FUNCTION_INFO_V1(hello_out);</span><br><span class="line">Datum</span><br><span class="line">hello_out(PG_FUNCTION_ARGS)</span><br><span class="line">&#123;</span><br><span class="line">	// get args[0]</span><br><span class="line">    Hello * hs = PG_GETARG_POINTER(0);</span><br><span class="line"></span><br><span class="line">    if(NULL != hs)&#123;</span><br><span class="line">        char * content = palloc(sizeof(HelloS));</span><br><span class="line">        strcpy(content,hs-&amp;gt;content);</span><br><span class="line">        PG_RETURN_CSTRING(content);</span><br><span class="line">    &#125;</span><br><span class="line">    PG_RETURN_CSTRING(&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PG_FUNCTION_INFO_V1(Hello);</span><br><span class="line">Datum</span><br><span class="line">Hello(PG_FUNCTION_ARGS)</span><br><span class="line">&#123;</span><br><span class="line">   HelloS* hs = PG_GETARG_POINTER(0);</span><br><span class="line"> if(NULL != hs)&#123;</span><br><span class="line">    char * res = palloc(sizeof(HelloS));</span><br><span class="line">    sprintf(res,&quot;hello %s&quot;,hs-&amp;gt;content);</span><br><span class="line">    PG_RETURN_CSTRING(res);</span><br><span class="line"> &#125;</span><br><span class="line"> PG_RETURN_CSTRING(&quot;hello nobody&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then cd your folder contrib/Hello, make, and make install</p>
<p>Then start psql to execute :</p>
<p>create table A(a HelloS);</p>
<p>insert into A values(‘cc’);</p>
<p>insert into A values(‘ff’);</p>
<p>select Hello(a) from A;</p>
<p>result:</p>
<p>Hello cc</p>
<p>Hello ff</p>
<p>select * from A;</p>
<p>result:</p>
<p>cc</p>
<p>ff</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/09/02/2010-09-02-error-lnk2019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/09/02/2010-09-02-error-lnk2019/" class="post-title-link" itemprop="url">Error LNK2019 Unresolved External Symbol </a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-09-02 00:00:00" itemprop="dateCreated datePublished" datetime="2010-09-02T00:00:00+08:00">2010-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-07 13:08:06" itemprop="dateModified" datetime="2023-10-07T13:08:06+08:00">2023-10-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/knowledge/" itemprop="url" rel="index"><span itemprop="name">knowledge</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/knowledge/program/" itemprop="url" rel="index"><span itemprop="name">program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>2 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <meta name="_edit_last" content="1" />
<meta name="_su_rich_snippet_type" content="none" />
<meta name="_su_keywords" content="LNK2019" />
<meta name="views" content="2408" />
Today I have found this problem :
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error LNK2019: unresolved external symbol __imp__gethostname@8 referenced in function _wmain</span><br><span class="line">and fatal error LNK1120: 1 unresolved externals </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>code fragment is :</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> len = <span class="number">256</span>;</span><br><span class="line">	<span class="type">char</span> buffer[len];</span><br><span class="line">	<span class="type">int</span> a = <span class="built_in">gethostname</span>(buffer,len);</span><br><span class="line">	cout &amp;lt;&amp;lt;ａ&amp;lt;&amp;lt;endl; <span class="comment">// a will be -1</span></span><br><span class="line">	cout &amp;lt;&amp;lt; buffer&amp;lt;&amp;lt;endl; <span class="comment">// buffer will be filled with unreadable code.</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><strong>What's wrong? </strong></h3>
If you don't add <span style="color: #000080;">#include &lt;WinSock2.h&gt;</span>, the compiler will report :  <span style="color: #800000;">error C3861: 'gethostname': identifier not found </span>. But after you adding this header, it will report above error again.  First, you should add the header &lt;afxext.h&gt; into stdafx.h, then compile the code again. Code will be compiled without any error. Then run this code fragment, and the result is not my expected. a is -1, and the buffer is filled with messy code. If you use WSAGetLastError() function to see it error code, the error code will be WSANOTINITIALISED. Yes, I have not initialized. So we should call WSAStartup() first and then gethostname. And WSAStartup() will check DLL version. And after having gotten hostname, don't forget to call WSACleanup(). Here is the whole code:
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="comment">//#include &amp;lt;winsock.h&amp;gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinSock2.h&gt;</span> <span class="comment">// use winsock2.h is ok</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> len = <span class="number">256</span>;</span><br><span class="line">	<span class="type">char</span> buffer[len];</span><br><span class="line">	WORD wVersionRequested;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	wVersionRequested = <span class="built_in">MAKEWORD</span>(<span class="number">2</span>,<span class="number">2</span>); <span class="comment">//version 2.2 </span></span><br><span class="line">	<span class="type">int</span> err = <span class="built_in">WSAStartup</span>(wVersionRequested,&amp;amp;wsaData);</span><br><span class="line">	<span class="keyword">if</span> (<span class="number">0</span> != err) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> ( <span class="built_in">LOBYTE</span>( wsaData.wVersion ) != <span class="number">2</span> ||</span><br><span class="line">        <span class="built_in">HIBYTE</span>( wsaData.wVersion ) != <span class="number">2</span> ) &#123;</span><br><span class="line">               <span class="comment">// only support version 2.2 of Windows Sockets </span></span><br><span class="line">			<span class="built_in">WSACleanup</span>();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// get hostname</span></span><br><span class="line">	<span class="type">int</span> a = <span class="built_in">gethostname</span>(buffer,len);</span><br><span class="line">	<span class="comment">/* if there is an error. use WSAGetLastError to find it.</span></span><br><span class="line"><span class="comment">	int errcode = WSAGetLastError();</span></span><br><span class="line"><span class="comment">	switch(errcode)&#123;</span></span><br><span class="line"><span class="comment">	 ....</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	cout &lt;&lt; buffer &lt;&lt; endl;</span><br><span class="line">	<span class="built_in">WSACleanup</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/08/19/5824898/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/08/19/5824898/" class="post-title-link" itemprop="url">快速生成大文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-08-19 20:48:00" itemprop="dateCreated datePublished" datetime="2010-08-19T20:48:00+08:00">2010-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>749</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在linux下如果不考虑断电系统重启等其他原因可以使用ftruncate()函数，这个函数输入参数为file descriptor 和 offset,<br />
这个函数在unistd.h中，windows一般是用不了这个的。</p>
<p>另外使用文件名得到文件描述符的方法就是int fileno(FILE*); 注意之后别忘了fclose(),下面的代码里忘记写了。</p>
<p>#include<iostream> #include<cstdio> #include&lt;unistd.h&gt; using namespace std;<br />
int main(){ FILE* f = fopen(“abc.txt”,“w”); int fd = fileno(f); long long<br />
offset = 1024<em>1024</em>1024*(long long)2; ftruncate(fd,offset); return 0; }</p>
<p>在windows及其他平台可以使用fseeko(FILE* , offset, pos)这个方法</p>
<p>#include<iostream> #include<cstdio> using namespace std; int main(){ FILE* f =<br />
fopen(“abc.txt”,“w”); long long offset=1024<em>1024</em>1024*(long long)2;<br />
fseeko(f,offset,SEEK_SET); int i = 10; // write i to file end<br />
fwrite(&amp;i,sizeof(int),1,f); fclose(f); return 0; }</p>
<p>这样就可以快速得到2G的文件了。另外编译时不要忘记添加编译参数  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64</p>
<p>想看大文件测试的结果到 <a target="_blank" rel="noopener" href="http://blog.csdn.net/cctt_1/archive/2010/05/23/5618652.aspx"> http://blog.csdn.net/cctt_1/archive/2010/05/23/5618652.aspx<br />
</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/08/13/2010-08-13-trickies-bugs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/08/13/2010-08-13-trickies-bugs/" class="post-title-link" itemprop="url">Trickies and Bugs in C</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-08-13 00:00:00" itemprop="dateCreated datePublished" datetime="2010-08-13T00:00:00+08:00">2010-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 23:07:00" itemprop="dateModified" datetime="2023-10-05T23:07:00+08:00">2023-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>2 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <meta name="_edit_last" content="1" />
<meta name="_su_rich_snippet_type" content="none" />
<meta name="views" content="542" />
the macro #define is the biggest hidden bug in c. You should always remember macro-function is like code paster. And it will slow down your system in some special situations, such as macro recursion. If you macro define some function use BIG characters.
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#define FUN1(a,b) a*b</span><br><span class="line">#define FUN2(a) a++;\</span><br><span class="line">     a*=a;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	int a = 2;</span><br><span class="line">	int b = 3;</span><br><span class="line">	FUN1(a,5+1); // =&amp;gt; 2*5+1</span><br><span class="line">        if(a&amp;gt;2)FUN2(a); //=&amp;gt; if(a&amp;gt;2) a++;a*=a;</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>strcpy() will copy “\0”, and it is dangerous when you copy two points.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int main()&#123;</span><br><span class="line">	char str1[] = &quot;abcd&quot;;</span><br><span class="line">	char str2[] = &quot;12&quot;;</span><br><span class="line">	strcpy(str1,str2); // ok, str1 equals &quot;12&quot;</span><br><span class="line">	char *st1 = &quot;abcd&quot;;</span><br><span class="line">	char *st2 = &quot;12&quot;;</span><br><span class="line">	strcpy(st1,st2); //crash!! st1 points to static const string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>param as point or array style. Although they are differnt styles, they are the same.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int size1(char a[])&#123;</span><br><span class="line">	cout &amp;lt;&amp;lt; sizeof(a);</span><br><span class="line">&#125;</span><br><span class="line">int size2(char* a)&#123;</span><br><span class="line">	cout &amp;lt;&amp;lt; sizeof(a);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	char a[] = &quot;abcdef&quot;;</span><br><span class="line">	char *b = &quot;abcdef&quot;;</span><br><span class="line">	size1(a); //  =&amp;gt; sizeof(char*)</span><br><span class="line">	size1(b); //  =&amp;gt; sizeof(char*)</span><br><span class="line">	size2(a); //  =&amp;gt; sizeof(char*)</span><br><span class="line">	size2(b);//  =&amp;gt; sizeof(char*)</span><br><span class="line">	cout &amp;lt;&amp;lt; sizeof(a)&amp;lt;&amp;lt;endl; // =&amp;gt;strlen(a)+1</span><br><span class="line">	cout &amp;lt;&amp;lt; sizeof(b)&amp;lt;&amp;lt;endl; // sizeof(char*)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// There are 5 segments in codes, DATA, BSS, TEXT, heap, stack</span><br><span class="line">// DATA stores all globel variables, and those variables are defined.</span><br><span class="line">// BSS stores all globel variables, but those variables are not defined.</span><br><span class="line">// const variables are in TEXT, and codes are in this segment also.</span><br><span class="line">// heap store (malloc, calloc,realloc, new) data</span><br><span class="line">// stack store function params, local variables.</span><br><span class="line"></span><br><span class="line">int a; // a is in BSS</span><br><span class="line">int b = 3; // b is in DATA</span><br><span class="line">int fun(int c)&#123; // c is in stack, when the function is called.</span><br><span class="line">	return 0; </span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	const int c = 4; // c is in TEXT</span><br><span class="line">	a = 4; // move to DATA</span><br><span class="line">	int x = 4; // in stack</span><br><span class="line">	int * p = malloc(sizeof(int)); // *p is in heap. but p is in stack.</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/07/22/5755632/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/07/22/5755632/" class="post-title-link" itemprop="url">Memory Leak 攻略</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-07-22 16:13:00" itemprop="dateCreated datePublished" datetime="2010-07-22T16:13:00+08:00">2010-07-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>2 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>相信几乎每个人都遇到过memory leak的问题。解决方法各不相同。</p>
<p>1。防止内存泄露</p>
<p>例如c<ins>中使用auto_ptr, java中自己的垃圾回收。对于纯java, python的语言编写的东西，memory<br />
leak一般不是啥米的问题，这些语言最严重的问题是内存不足。这些java要处理内存不足就-Xmx1024m或者开更大的内存，或者闲得无聊的时候调调gc.<br />
python的解决方法差不多，不过它可以显式delete. 另外听说python调用django时会有内存分配不足的问题，原因在于django这鬼东西在de<br />
bug＝=true时没有对sql查询进行释放。下面接着过去的话题扯下c</ins>/c这些需要自己care的语言。<br />
c++中有auto_ptr这东东算是可以，因为遵循RAII(resource acquirement is initial 不知道自己英文拼对了没有)， 也<br />
就是说：在类初始化的时候申请资源，在类析构的时候释放资源。另外注意析构函数是virtual的。为啥米呢？因为要多态调用析构父类。如果自己写的类不是那么标准，<br />
喜欢到处申请资源，到处释放资源，还是建议使用auto_ptr这个类，它在<memory>中。其实auto_ptr类似于下面的代码：</p>
<p>template<class T> class simple_auto_ptr{ private: T* point; public: explicit<br />
simple_auto_ptr(T* point):point(point){} virtual ~simple_auto_ptr(){delete<br />
point;} }; 调用代码例如simple_auto_ptr<int> a(new int(3));</p>
<p>这东东的作用在于简化下面的代码：</p>
<p>void foo(){ T* a = new T(); try{ throw something; }catch(something){<br />
if(NULL!=a){ delete a; a=NULL; } } if(NULL != a) delete a; } 使用auto_ptr<br />
将上面的简化为 void foo(){ auto_ptr<T> a(new T()); throw something; }</p>
<p>可以说还是有些用处的…不过不能用于申请数组…除非你想申请auto_ptr的数组。另外传说不能用于容器类。所以为了不让内存泄露，还是需要谨慎小心。</p>
<p>2。监测内存泄露，使用监测内存泄露的小工具</p>
<p>另外有一些监测工具可以帮你检查一部分内存泄露的问题。有些工具其实就是替换了free/malloc/realloc/calloc 或者是<br />
new/delete.采用宏定义就可以轻松做到：</p>
<p>#define new MY_NEW #define MY_NEW my_new</p>
<p>然后就可以截获new/delete的函数调用，至于你想再多做一些事情，就看你宏定义和你函数的具体写法了。然后就如同左右括号匹配一样。当然往往不是那么简单，例<br />
如类中的一些指针有还有一些内存检测是需要你传入指针进去，然后catch指针做些监测工作。</p>
<p>但有些memory leak的问题很难被监测到，或者有时候会被误报。比如某个指针在函数中申请空间并传出，然后在外面进行n次转换，并进行加加见见运算，最后变为<br />
另外一个指针。除非检测工具做了名字的转换，可以进行数学运算，比如int * a = new int[20]; int * c = ++a; delete<br />
[] --c;当然这里只是一个模拟，没有人会这样写代码。但是真正的程序中很有可能代码简化后就是这样的情况。当然进行dynamic_cast的情况更加复杂，还<br />
需要判断析构函数是否是虚函数等问题。</p>
<p>3。断言法</p>
<p>测试程序正确性很难监测出内存泄露的情况。</p>
<p>下面以链表为例：list_insert()时原List比现List少1个元素，list_delete()时,原List比现List多一个元素。</p>
<p>List * l = new List(); size_t old = l-&gt;size(); l-&gt;list_insert(some elements);<br />
size_t new = l-&gt;size(); assert(new-old == 1); old = l-&gt;size();<br />
l-&gt;list_delete(some elements); new = l-&gt;size(); assert(old-new == 1); //<br />
另外必须保证list的size其实和具体的值无关，应该是遍历后的结果</p>
<p>即使这里的size变化是正确的，这也依旧不能保证list_delete()中调用了合适的delete 方法，有可能没有进行delete, 或者进行了节点的d<br />
elete，但是组成链表中的节点的析构函数没有写好，也会造成内存泄露。个人就遇到PG中删除链表函数的问题。原链表长度的确是减小了。但是链表节点的内存的确没有<br />
释放。</p>
<p>4。模拟法</p>
<p>这个方法其实很好用，一般在已经确定可能是某一个大模块的问题，但是不清楚内部可能的路径，也有可能是路径太过复杂。这里就可以模拟一下。化简各种流程，仅仅调用申请<br />
释放资源的几个主要函数。然后逐一排除各个主要函数的可能性。例如那个链表，如果起初的业务流程有许多复杂的链表操作，但是申请释放空间的地方其实就是list_in<br />
sert()和list_delete(),这就可以仅仅是调用几千次list_new(),list_delete()看看情况.内存泄露就会明显显现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chillyc.info/2010/07/21/5751498/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/icon.svg">
      <meta itemprop="name" content="帐前卒">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="帐前卒专栏">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 帐前卒专栏">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2010/07/21/5751498/" class="post-title-link" itemprop="url">转载一篇关于Linux 监视进程的文章...</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2010-07-21 09:42:00" itemprop="dateCreated datePublished" datetime="2010-07-21T09:42:00+08:00">2010-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-05 12:41:46" itemprop="dateModified" datetime="2023-10-05T12:41:46+08:00">2023-10-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>408</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><span class="exturl" data-url="aHR0cDovL2xpbnV4LnZiaXJkLm9yZy9saW51eF9iYXNpYy8wNDQwcHJvY2Vzc2NvbnRyb2wucGhw">http://linux.vbird.org/linux_basic/0440processcontrol.php<i class="fa fa-external-link-alt"></i></span></p>
<p>top: failed tty get 错误, 因为top中没有加上-b选项。</p>
<p>free是监视内存的 used, free, swap等东东。</p>
<p>vmstat  是监视硬盘使用情况的。io情况的.包括memory, swap, io,system,cpu等</p>
<p>netstat 监视网络使用情况的，包括socket和协议等，以及传输的字节和接受的字节以及套接字类型stream/DGRAM/RAW</p>
<p>ps aux监视进程用的，一般可以看出占用cpu，memory的百分比和进程的优先级</p>
<p>ps -l 也是监视进程用的，一般看的是此bash下的进程使用cpu和内存的情况</p>
<p>top 这个很有用，用于监视某个进程。包括IO,cpu,内存等。其中的wa很有用，是wait event或者IO的百分比。id是cpu idle的情况。</p>
<p>基本上脚本监视也就用到这几个常用东西了…</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/22/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/80/">80</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/24/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">帐前卒</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Word count total: </span>
    <span title="Word count total">1.6m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">24:23</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/motion.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/next-boot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/bookmark.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/third-party/search/local-search.min.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha256-3574TpfThVfeAhg+I4+N39EJiLN3QUkuEsMVe8hWAR4=" crossorigin="anonymous">


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"chilly/blog_comments","issue_term":"url","theme":"github-dark"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.18.1/source/js/third-party/comments/utterances.min.js"></script>

</body>
</html>
